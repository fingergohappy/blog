{"title":"gradle spring boot 打包无依赖jar","uid":"0610eea3c26eecbde57cb388bda23db3","slug":"gradle-spring-boot-without-dependency","date":"2023-12-22T12:21:39.000Z","updated":"2023-12-22T12:31:48.368Z","comments":true,"path":"api/articles/gradle-spring-boot-without-dependency.json","keywords":null,"cover":"https://source.unsplash.com/1200x628","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>希望<code>spring-boot</code>的<code>jar</code>包不包含项目的依赖,打包成一个轻量<code>jar</code>包,方便部署和快速打包</p>\n<h1 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一:\"></a>方法一:</h1><p>修改<code>build.gradle.kts</code>:</p>\n<div class=\"language-kotlin\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">kotlin</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">tasks.</span><span style=\"color: #50FA7B\">withType</span><span style=\"color: #F8F8F2\">&lt;</span><span style=\"color: #8BE9FD; font-style: italic\">Jar</span><span style=\"color: #F8F8F2\">&gt;&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">manifest</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        attributes[</span><span style=\"color: #F1FA8C\">&quot;Main-Class&quot;</span><span style=\"color: #F8F8F2\">] </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">&quot;com.io.alyze.AlyzeApplicationKt&quot;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        </span><span style=\"color: #6272A4\">//添加所有依赖的</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        attributes[</span><span style=\"color: #F1FA8C\">&quot;Class-Path&quot;</span><span style=\"color: #F8F8F2\">] </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\">  configurations.runtimeClasspath.</span><span style=\"color: #50FA7B\">get</span><span style=\"color: #F8F8F2\">().files.</span><span style=\"color: #50FA7B\">joinToString</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&quot; &quot;</span><span style=\"color: #F8F8F2\">) &#123; </span><span style=\"color: #F1FA8C\">&quot;./libs/</span><span style=\"color: #FF79C6\">$&#123;</span><span style=\"color: #F1FA8C\">it.name</span><span style=\"color: #FF79C6\">&#125;</span><span style=\"color: #F1FA8C\">&quot;</span><span style=\"color: #F8F8F2\"> &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">tasks.</span><span style=\"color: #50FA7B\">register</span><span style=\"color: #F8F8F2\">&lt;</span><span style=\"color: #8BE9FD; font-style: italic\">Copy</span><span style=\"color: #F8F8F2\">&gt;(</span><span style=\"color: #F1FA8C\">&quot;jar-dependency&quot;</span><span style=\"color: #F8F8F2\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">dependsOn</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&quot;jar&quot;</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">from</span><span style=\"color: #F8F8F2\">(configurations.runtimeClasspath)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">into</span><span style=\"color: #F8F8F2\">(layout.buildDirectory.</span><span style=\"color: #50FA7B\">dir</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&quot;libs/libs/&quot;</span><span style=\"color: #F8F8F2\">))</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><p>这样执行:<code>./gradlew :jar-dependency</code> 就会在<code>build/lib</code>目录生成一个<code>xxx-palin.jar</code>和一个<code>libs</code>文件夹</p>\n<p>将这两个文件拷贝在一起,以使用<code>java -jar xxx-plain.jar</code>直接运行</p>\n<h1 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h1><p>修改<code>build.gradle.kts</code>:</p>\n<div class=\"language-kotlin\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">kotlin</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">tasks.</span><span style=\"color: #50FA7B\">register</span><span style=\"color: #F8F8F2\">&lt;</span><span style=\"color: #8BE9FD; font-style: italic\">Copy</span><span style=\"color: #F8F8F2\">&gt;(</span><span style=\"color: #F1FA8C\">&quot;jar-dependency&quot;</span><span style=\"color: #F8F8F2\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">dependsOn</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&quot;jar&quot;</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">from</span><span style=\"color: #F8F8F2\">(configurations.runtimeClasspath)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #50FA7B\">into</span><span style=\"color: #F8F8F2\">(layout.buildDirectory.</span><span style=\"color: #50FA7B\">dir</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&quot;libs/libs/&quot;</span><span style=\"color: #F8F8F2\">))</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><p>这样执行:<code>./gradlew :jar-dependency</code> 就会在<code>build/lib</code>目录生成一个<code>xxx-palin.jar</code>和一个<code>libs</code>文件夹</p>\n<p>将这两个文件拷贝在一起,可以使用<code>java -cp &quot;alyze-1.0-plain.jar:libs/*&quot; your_main_class_name</code>直接运行</p>\n","text":"gradle将spring boot项目打包成无依赖jar包的轻量级包...","permalink":"/post/gradle-spring-boot-without-dependency","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"java","slug":"java","count":2,"path":"api/categories/java.json"}],"tags":[{"name":"java","slug":"java","count":2,"path":"api/tags/java.json"},{"name":"gradle","slug":"gradle","count":2,"path":"api/tags/gradle.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%B8%80\"><span class=\"toc-text\">方法一:</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%BA%8C\"><span class=\"toc-text\">方法二</span></a></li></ol>","author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"hexo push后自动部署github pages","uid":"3a126c86808bf36e1aa89411751a60c9","slug":"hexo-auto-deploy","date":"2023-09-20T01:31:18.000Z","updated":"2023-09-21T14:57:24.942Z","comments":true,"path":"api/articles/hexo-auto-deploy.json","keywords":null,"cover":"https://source.unsplash.com/lzh3hPtJz9c/1200x628","text":"hexo 提交后自动部署github page...","permalink":"/post/hexo-auto-deploy","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"hexo","slug":"hexo","count":1,"path":"api/categories/hexo.json"}],"tags":[{"name":"hexo","slug":"hexo","count":1,"path":"api/tags/hexo.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"gradle将spring-boot和vue打入一个jar包","uid":"56b23b84b250019b3083e955ae6b9980","slug":"gradle-spring-boot-vue-one-jar","date":"2023-11-11T07:23:43.000Z","updated":"2023-11-11T07:48:48.040Z","comments":true,"path":"api/articles/gradle-spring-boot-vue-one-jar.json","keywords":null,"cover":"https://source.unsplash.com/1200x628","text":"使用gradle将spring-boot和vue打入一个jar包...","permalink":"/post/gradle-spring-boot-vue-one-jar","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"gradle","slug":"gradle","count":1,"path":"api/categories/gradle.json"}],"tags":[{"name":"gradle","slug":"gradle","count":2,"path":"api/tags/gradle.json"},{"name":"spring-boot","slug":"spring-boot","count":1,"path":"api/tags/spring-boot.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}