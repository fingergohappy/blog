{"title":"neovim配置formatters","uid":"278663bc5f0ce8aa9f1bcfa6468a4791","slug":"neovim-config-formatter","date":"2023-11-01T16:05:14.000Z","updated":"2023-11-01T08:28:03.753Z","comments":true,"path":"api/articles/neovim-config-formatter.json","keywords":null,"cover":"https://source.unsplash.com/gray-laptop-computer-turned-on-EaB4Ml7C7fE/1200x628","content":"<p>最近再搞<code>vue3</code>,使用了<a href=\"https://element-plus-admin.cn/\">element plus admin</a>这个模版库,没想到一直报错<br>后来经过排查发现是这个模板库使用了<a href=\"https://prettier.io/\">prettier</a>这位<code>lint</code>的配置项,简单来说就是如果不符合他的格式就会报错,<br>而我的<code>neovim</code>是使用的<code>volar</code>这个<code>lsp</code>作为格式化话的后端,想要保存自动安装<code>prettier</code>的格式格式化,需要额外加一些配置</p>\n<p>本来是想打算用<a href=\"https://github.com/jose-elias-alvarez/null-ls.nvim\">null-ls</a>,因为更符合哲学的,其实就是将一些<code>formatter</code>作为<code>neovim</code>原生的<code>lsp</code>inject进去<br>不过这个项目目前停更了,而且我也只是想保存的时候格式化就行了,所以就选择了另一个插件<a href=\"https://github.com/mhartington/formatter.nvim\">formatter.nvim</a></p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h2 id=\"安装prettier\"><a href=\"#安装prettier\" class=\"headerlink\" title=\"安装prettier\"></a>安装prettier</h2><p>在<code>mason</code>中找到<code>prettier</code>安装就行<br>不过这个地方比较有意思,<code>mason</code>其实是安装了<code>prettier</code>的,按时我在终端中缺无法使用,后来发现<code>mason</code>安装的工具其实是在<code>~/.local/share/nvim/mason/bin/</code>里面,然后在放到<code>neovim</code>内置的环境变量中是,在<code>neovim</code>的命令模式执行<code>:!env</code>就可以看到</p>\n<h2 id=\"安装formatter-nvim\"><a href=\"#安装formatter-nvim\" class=\"headerlink\" title=\"安装formatter.nvim\"></a>安装formatter.nvim</h2><div class=\"language-lua\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">lua</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">    &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">            </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">mhartington/formatter.nvim</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">            name </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">formatter</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                event </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">BufEnter</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                enabled </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #BD93F9\">true</span><span style=\"color: #F8F8F2\">,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                </span><span style=\"color: #FF79C6\">#</span><span style=\"color: #F8F8F2\"> 这个配置一定要写到config选项中,不然会报错</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                </span><span style=\"color: #50FA7B\">config</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #FF79C6\">function</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #FFB86C; font-style: italic\">LazyPlugin</span><span style=\"color: #F8F8F2\">,</span><span style=\"color: #FFB86C; font-style: italic\">opts</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                </span><span style=\"color: #FF79C6\">local</span><span style=\"color: #F8F8F2\"> opts </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                    logging </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #BD93F9\">true</span><span style=\"color: #F8F8F2\">,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                    log_level </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> vim.log.levels.WARN,</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                    filetype </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                        vue </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                            </span><span style=\"color: #8BE9FD\">require</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">formatter.filetypes.vue</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">).</span><span style=\"color: #50FA7B\">prettier</span><span style=\"color: #F8F8F2\">(),</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                            _</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                            &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">                </span><span style=\"color: #8BE9FD\">require</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">formatter</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">).</span><span style=\"color: #50FA7B\">setup</span><span style=\"color: #F8F8F2\">(opts)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">            </span><span style=\"color: #FF79C6\">end</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        &#125;</span></span>\n<span class=\"line\"></span></code></pre></div><p>这里需要注意的点是</p>\n<ol>\n<li>formatter并没用给默认的格式化配置,所以没中文件都要配置</li>\n<li>配置想要写到<code>lazyvim</code>的<code>config</code>选项中,不然会提示找不到<code>formatter.filetypes.vue</code></li>\n</ol>\n<h1 id=\"保存自动格式化\"><a href=\"#保存自动格式化\" class=\"headerlink\" title=\"保存自动格式化\"></a>保存自动格式化</h1><div class=\"language-lua\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">lua</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">vim.api.</span><span style=\"color: #50FA7B\">nvim_create_autocmd</span><span style=\"color: #F8F8F2\">(&#123;</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">BufWritePost</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">&#125;,&#123;pattern </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">*</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">&#125;,command </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">FormatWrite</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">&#125;)</span></span>\n<span class=\"line\"></span></code></pre></div><h1 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h1><p><code>formatter.nvim</code>相当于一个接口,然后自己配置格式化命令,当执行格式化命令时,会调用你配置的格式化命令,如果不配置就是使用默认的,想上面的<code>vue</code>执行格式化的时候其实就是在执行默认的格式化,约等于下面的伪代码:</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #50FA7B\">prettier</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #BD93F9\">--stdin-filepath</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">%</span></span></code></pre></div>","text":"neovim配置formatters...","permalink":"/post/neovim-config-formatter","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"neovim奇技淫巧","slug":"neovim奇技淫巧","count":2,"path":"api/categories/neovim奇技淫巧.json"}],"tags":[{"name":"neovim","slug":"neovim","count":2,"path":"api/tags/neovim.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85prettier\"><span class=\"toc-text\">安装prettier</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85formatter-nvim\"><span class=\"toc-text\">安装formatter.nvim</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BF%9D%E5%AD%98%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96\"><span class=\"toc-text\">保存自动格式化</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理</span></a></li></ol>","author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"hexo push后自动部署github pages","uid":"3a126c86808bf36e1aa89411751a60c9","slug":"hexo-auto-deploy","date":"2023-09-20T09:31:18.000Z","updated":"2023-11-01T08:28:03.745Z","comments":true,"path":"api/articles/hexo-auto-deploy.json","keywords":null,"cover":"https://source.unsplash.com/lzh3hPtJz9c/1200x628","text":"hexo 提交后自动部署github page...","permalink":"/post/hexo-auto-deploy","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"hexo","slug":"hexo","count":1,"path":"api/categories/hexo.json"}],"tags":[{"name":"hexo","slug":"hexo","count":1,"path":"api/tags/hexo.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"管道操作符和xargs的区别","uid":"b44d691eb810037cdb9efa730e0764ea","slug":"shell-pipeline-and-xargs","date":"2023-10-31T17:38:16.000Z","updated":"2023-11-01T08:28:03.753Z","comments":true,"path":"api/articles/shell-pipeline-and-xargs.json","keywords":null,"cover":"https://source.unsplash.com/a-computer-screen-with-a-program-running-on-it-NLSXFjl_nhc/1200x628","text":"shell中管道操作符和xargs的区别...","permalink":"/post/shell-pipeline-and-xargs","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"shell","slug":"shell","count":1,"path":"api/categories/shell.json"}],"tags":[{"name":"shell","slug":"shell","count":1,"path":"api/tags/shell.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}