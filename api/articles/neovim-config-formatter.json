{"title":"neovim配置formatters","uid":"278663bc5f0ce8aa9f1bcfa6468a4791","slug":"neovim-config-formatter","date":"2023-11-01T16:05:14.000Z","updated":"2024-01-05T08:09:03.746Z","comments":true,"path":"api/articles/neovim-config-formatter.json","keywords":null,"cover":"https://source.unsplash.com/gray-laptop-computer-turned-on-EaB4Ml7C7fE/1200x628","content":"<p>最近再搞<code>vue3</code>,使用了<a href=\"https://element-plus-admin.cn/\">element plus admin</a>这个模版库,没想到一直报错<br>后来经过排查发现是这个模板库使用了<a href=\"https://prettier.io/\">prettier</a>这位<code>lint</code>的配置项,简单来说就是如果不符合他的格式就会报错,<br>而我的<code>neovim</code>是使用的<code>volar</code>这个<code>lsp</code>作为格式化话的后端,想要保存自动安装<code>prettier</code>的格式格式化,需要额外加一些配置</p>\n<p>本来是想打算用<a href=\"https://github.com/jose-elias-alvarez/null-ls.nvim\">null-ls</a>,因为更符合哲学的,其实就是将一些<code>formatter</code>作为<code>neovim</code>原生的<code>lsp</code>inject进去<br>不过这个项目目前停更了,而且我也只是想保存的时候格式化就行了,所以就选择了另一个插件<a href=\"https://github.com/mhartington/formatter.nvim\">formatter.nvim</a></p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h2 id=\"安装prettier\"><a href=\"#安装prettier\" class=\"headerlink\" title=\"安装prettier\"></a>安装prettier</h2><p>在<code>mason</code>中找到<code>prettier</code>安装就行<br>不过这个地方比较有意思,<code>mason</code>其实是安装了<code>prettier</code>的,按时我在终端中缺无法使用,后来发现<code>mason</code>安装的工具其实是在<code>~/.local/share/nvim/mason/bin/</code>里面,然后在放到<code>neovim</code>内置的环境变量中是,在<code>neovim</code>的命令模式执行<code>:!env</code>就可以看到</p>\n<h2 id=\"安装formatter-nvim\"><a href=\"#安装formatter-nvim\" class=\"headerlink\" title=\"安装formatter.nvim\"></a>安装formatter.nvim</h2><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;mhartington/formatter.nvim&quot;</span>,</span><br><span class=\"line\">        name = <span class=\"string\">&quot;formatter&quot;</span>,</span><br><span class=\"line\">            event = <span class=\"string\">&quot;BufEnter&quot;</span>,</span><br><span class=\"line\">            enabled = <span class=\"literal\">true</span>,</span><br><span class=\"line\">            # 这个配置一定要写到<span class=\"built_in\">config</span>选项中,不然会报错</span><br><span class=\"line\">            <span class=\"built_in\">config</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(LazyPlugin,opts)</span></span></span><br><span class=\"line\">            <span class=\"keyword\">local</span> opts = &#123;</span><br><span class=\"line\">                logging = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                log_level = vim.<span class=\"built_in\">log</span>.levels.WARN,</span><br><span class=\"line\">                filetype = &#123;</span><br><span class=\"line\">                    vue = &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">require</span>(<span class=\"string\">&quot;formatter.filetypes.vue&quot;</span>).prettier(),</span><br><span class=\"line\">                        _</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">require</span>(<span class=\"string\">&quot;formatter&quot;</span>).setup(opts)</span><br><span class=\"line\">        <span class=\"keyword\">end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这里需要注意的点是</p>\n<ol>\n<li>formatter并没用给默认的格式化配置,所以没中文件都要配置</li>\n<li>配置想要写到<code>lazyvim</code>的<code>config</code>选项中,不然会提示找不到<code>formatter.filetypes.vue</code></li>\n</ol>\n<h1 id=\"保存自动格式化\"><a href=\"#保存自动格式化\" class=\"headerlink\" title=\"保存自动格式化\"></a>保存自动格式化</h1><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim.api.nvim_create_autocmd(&#123;<span class=\"string\">&quot;BufWritePost&quot;</span>&#125;,&#123;pattern = &#123;<span class=\"string\">&quot;*&quot;</span>&#125;,command = <span class=\"string\">&quot;FormatWrite&quot;</span>&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h1><p><code>formatter.nvim</code>相当于一个接口,然后自己配置格式化命令,当执行格式化命令时,会调用你配置的格式化命令,如果不配置就是使用默认的,想上面的<code>vue</code>执行格式化的时候其实就是在执行默认的格式化,约等于下面的伪代码:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">prettier --stdin-filepath %</span><br></pre></td></tr></table></figure>\n","text":"neovim配置formatters...","permalink":"/post/neovim-config-formatter","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"neovim奇技淫巧","slug":"neovim奇技淫巧","count":2,"path":"api/categories/neovim奇技淫巧.json"}],"tags":[{"name":"neovim","slug":"neovim","count":2,"path":"api/tags/neovim.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85prettier\"><span class=\"toc-text\">安装prettier</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85formatter-nvim\"><span class=\"toc-text\">安装formatter.nvim</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BF%9D%E5%AD%98%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96\"><span class=\"toc-text\">保存自动格式化</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理</span></a></li></ol>","author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"gradle将spring-boot和vue打入一个jar包","uid":"56b23b84b250019b3083e955ae6b9980","slug":"gradle-spring-boot-vue-one-jar","date":"2023-11-11T15:23:43.000Z","updated":"2024-01-05T08:09:03.738Z","comments":true,"path":"api/articles/gradle-spring-boot-vue-one-jar.json","keywords":null,"cover":"https://source.unsplash.com/1200x628","text":"使用gradle将spring-boot和vue打入一个jar包...","permalink":"/post/gradle-spring-boot-vue-one-jar","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"gradle","slug":"gradle","count":1,"path":"api/categories/gradle.json"}],"tags":[{"name":"gradle","slug":"gradle","count":2,"path":"api/tags/gradle.json"},{"name":"spring-boot","slug":"spring-boot","count":1,"path":"api/tags/spring-boot.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"管道操作符和xargs的区别","uid":"b44d691eb810037cdb9efa730e0764ea","slug":"shell-pipeline-and-xargs","date":"2023-10-31T17:38:16.000Z","updated":"2024-01-05T08:09:03.746Z","comments":true,"path":"api/articles/shell-pipeline-and-xargs.json","keywords":null,"cover":"https://source.unsplash.com/a-computer-screen-with-a-program-running-on-it-NLSXFjl_nhc/1200x628","text":"shell中管道操作符和xargs的区别...","permalink":"/post/shell-pipeline-and-xargs","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"shell","slug":"shell","count":1,"path":"api/categories/shell.json"}],"tags":[{"name":"shell","slug":"shell","count":1,"path":"api/tags/shell.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}