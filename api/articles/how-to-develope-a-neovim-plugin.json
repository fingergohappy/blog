{"title":"手把手教你开发一个neovim插件","uid":"20b1dd25546ad76a413c67b885fd05e2","slug":"how-to-develope-a-neovim-plugin","date":"2023-10-12T17:10:19.000Z","updated":"2023-11-01T08:00:27.577Z","comments":true,"path":"api/articles/how-to-develope-a-neovim-plugin.json","keywords":null,"cover":"https://source.unsplash.com/iMwiPZNX3SI/1200x628","content":"<h1 id=\"开篇废话\"><a href=\"#开篇废话\" class=\"headerlink\" title=\"开篇废话\"></a>开篇废话</h1><p>使用<code>neovim</code>久了,使用了众多插件,不自己开发一个插件,怎么好标榜自己是一个<code>vimer</code>?<br>今天老夫就手把手教大家开发一个自己的<code>neovim</code>插件</p>\n<h1 id=\"项目结构与插件路径\"><a href=\"#项目结构与插件路径\" class=\"headerlink\" title=\"项目结构与插件路径\"></a>项目结构与插件路径</h1><h2 id=\"插件路径\"><a href=\"#插件路径\" class=\"headerlink\" title=\"插件路径\"></a>插件路径</h2><p>这里差不多也是废话,理论上来说,<code>vim</code>的插件可以在任何位置,插件的方式也可以是各种形式,不过为了这里面还是有一些潜规则的.<br>首先就是插件的路径了,一般来说,<code>neovim</code>会默认加载一些路径,可以在<code>neovim</code>中执行<code>echo &amp;rtp</code>(rtp:runtim time path)来查看默认的加载路径有哪些,不过由于我们是<br>自己开发的插件,就暂时不要放在这些路径里面了,避免启动时报错,假设我现在放在了<code>~/temp/neovim/lua/lowb</code>这个目录下进行开发<code>lowb</code>插件,然后在启动<code>neovim</code>的时候使用<code>nvim --cmd &quot;set rtp+=~/temp/neovim&quot;</code>启动就可以加载<code>lowb</code>插件了,<br>插件名就是<code>lua</code>路径下的文件夹名,如果你的插件比较简单,可以不用新建一个文件夹,直接搞一个<code>lowb.lua</code>就可以加载了,不过按照约定一般是有一个文件夹的,方便发布,供其他人使用</p>\n<p><strong>这里需要注意,一定放在<code>lua</code>的子目录下,否则<code>neovim</code>是不会进行加载这个插件的,<a href=\"https://neovim.io/doc/user/lua-guide.html#lua-guide-modules\">参考</a></strong></p>\n<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><h3 id=\"init-lua\"><a href=\"#init-lua\" class=\"headerlink\" title=\"init.lua\"></a>init.lua</h3><p><code>neovim</code>会自动加载目录下的<code>init.lua</code>作为<code>neovim</code>的默认加载文件</p>\n<h1 id=\"开始开发\"><a href=\"#开始开发\" class=\"headerlink\" title=\"开始开发\"></a>开始开发</h1><h2 id=\"加载\"><a href=\"#加载\" class=\"headerlink\" title=\"加载\"></a>加载</h2><p>确定了插件路径和项目结构,就可以开发<code>lowb</code>插件了,在<code>~/temp/neovim/lua/lowb</code>,先新建一个<code>init.lua</code>文件,文件内容如下:</p>\n<div class=\"language-lua\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">lua</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #8BE9FD\">print</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">Hello lowb</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"></span></code></pre></div><p>然后使用<code>nvim -c &quot;set rtp+=~/temp/neovim&quot;</code>启动<code>neovim</code> </p>\n<p>进入<code>neovim</code>的命令模式执行:<code>lua require(&#39;lowb&#39;)</code><br>可以看到会打印<code>Hello lowb</code><br>OK,现在插件成功加载了</p>\n<h2 id=\"导出函数\"><a href=\"#导出函数\" class=\"headerlink\" title=\"导出函数\"></a>导出函数</h2><p>插件肯定不能简单的加载,还要导出一些函数供用户使用,更新<code>init.lua</code></p>\n<div class=\"language-lua\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">lua</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FF79C6\">local</span><span style=\"color: #F8F8F2\"> M </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;&#125;</span></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">function</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #50FA7B\">M</span><span style=\"color: #F8F8F2\">.</span><span style=\"color: #50FA7B\">say_lowb</span><span style=\"color: #F8F8F2\">()</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #8BE9FD\">print</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">hello lowb</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">end</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">return</span><span style=\"color: #F8F8F2\"> M</span></span></code></pre></div><p>保存插件,重新使用命令<code>nvim -c &quot;set rtp+=~/temp/neovim&quot;</code>启动<code>neovim</code><br>进入<code>neovim</code>的命令模式执行:<code>lua require(&#39;lowb&#39;).say_lowb()</code></p>\n<p>现在<code>lowb</code>插件基本完成,还有一项功能就是给用户设置的能力</p>\n<h2 id=\"setup函数\"><a href=\"#setup函数\" class=\"headerlink\" title=\"setup函数\"></a>setup函数</h2><p><code>neovim</code>插件一般是通过向外暴露一个<code>setup</code>函数来给用户设定,这倒不是强制规定,只是一个默认约定,像一些插件管理工具,比如<a href=\"https://github.com/folke/lazy.nvim\">lazy.vim</a>一般就是默认使用<code>setup</code>来进行初始化插件,</p>\n<p>现在再改一下<code>init.lua</code>文件</p>\n<div class=\"language-lua\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">lua</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FF79C6\">local</span><span style=\"color: #F8F8F2\"> default_config </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    name </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">狗蛋</span><span style=\"color: #E9F284\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">local</span><span style=\"color: #F8F8F2\"> M </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    config </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> default_config</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">function</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #50FA7B\">M</span><span style=\"color: #F8F8F2\">.</span><span style=\"color: #50FA7B\">say_lowb</span><span style=\"color: #F8F8F2\">()</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #8BE9FD\">print</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">hello lowb </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #FF79C6\">..</span><span style=\"color: #F8F8F2\">M.config.name)</span></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">end</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">function</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #50FA7B\">M</span><span style=\"color: #F8F8F2\">.</span><span style=\"color: #50FA7B\">setup</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #FFB86C; font-style: italic\">config</span><span style=\"color: #F8F8F2\">)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    M.config </span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\"> config</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    vim.</span><span style=\"color: #50FA7B\">print</span><span style=\"color: #F8F8F2\">(M)</span></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">end</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FF79C6\">return</span><span style=\"color: #F8F8F2\"> M</span></span>\n<span class=\"line\"></span></code></pre></div><p>保存退出,重新使用命令:<code>nvim -c &quot;set rtp+=~/temp/neovim&quot;</code> 启动<code>neovim</code>,</p>\n<p>进入命令模式执行以下命令</p>\n<div class=\"language-vim\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">vim</span><pre class=\"shiki dracula\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">lua </span><span style=\"color: #50FA7B\">require</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&#39;lowb&#39;</span><span style=\"color: #F8F8F2\">)</span><span style=\"color: #50FA7B\">.setup</span><span style=\"color: #F8F8F2\">(&#123;name</span><span style=\"color: #FF79C6\">=</span><span style=\"color: #F8F8F2\">finger&#125;)</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">lua </span><span style=\"color: #50FA7B\">require</span><span style=\"color: #F8F8F2\">(</span><span style=\"color: #F1FA8C\">&#39;lowb&#39;</span><span style=\"color: #F8F8F2\">)</span><span style=\"color: #50FA7B\">.say_lowb</span><span style=\"color: #F8F8F2\">()</span></span>\n<span class=\"line\"></span></code></pre></div><p>就会看到打印的信息从”狗蛋”更新为”finger”</p>\n<p>现在一个简单的<code>neovim</code>插件就开发完成了,至于能做什么</p>\n<p><strong>想象力越大,能力越大</strong></p>\n","text":"手把手胸贴胸教你开发一个neovim插件...","permalink":"/post/how-to-develope-a-neovim-plugin","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"neovim奇技淫巧","slug":"neovim奇技淫巧","count":1,"path":"api/categories/neovim奇技淫巧.json"}],"tags":[{"name":"neovim","slug":"neovim","count":1,"path":"api/tags/neovim.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BC%80%E7%AF%87%E5%BA%9F%E8%AF%9D\"><span class=\"toc-text\">开篇废话</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E6%8F%92%E4%BB%B6%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">项目结构与插件路径</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8F%92%E4%BB%B6%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">插件路径</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">项目结构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#init-lua\"><span class=\"toc-text\">init.lua</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%A7%8B%E5%BC%80%E5%8F%91\"><span class=\"toc-text\">开始开发</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD\"><span class=\"toc-text\">加载</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">导出函数</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#setup%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">setup函数</span></a></li></ol></li></ol>","author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"idea怎么在project 选项卡中隐藏特定的文件和文件夹","uid":"10511efcdf050e7b6a632b67005878d9","slug":"idea-how-to-hide-folder-in-project","date":"2023-10-13T15:01:29.000Z","updated":"2023-11-01T08:00:27.577Z","comments":true,"path":"api/articles/idea-how-to-hide-folder-in-project.json","keywords":null,"cover":"https://source.unsplash.com/a-close-up-of-a-laptop-computer-with-code-on-the-screen-lYFERR5dTG4/1200x628","text":"idea在特定选项卡中隐藏特定的文件或文件夹...","permalink":"/post/idea-how-to-hide-folder-in-project","photos":[],"count_time":{"symbolsCount":134,"symbolsTime":"1 mins."},"categories":[{"name":"some litttle tricks","slug":"some-litttle-tricks","count":2,"path":"api/categories/some-litttle-tricks.json"}],"tags":[{"name":"idea","slug":"idea","count":2,"path":"api/tags/idea.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"使用asdf管理你的sdk","uid":"001dfc01a72db15c12cec35ea2336846","slug":"use-asdf-manage-sdk","date":"2023-09-26T12:18:16.000Z","updated":"2023-11-01T08:00:27.593Z","comments":true,"path":"api/articles/use-asdf-manage-sdk.json","keywords":null,"cover":"https://source.unsplash.com/monitor-displaying-indexhtml-codes-_SgRNwAVNKw/1200x628","text":"对于我这种使用多种语言开发,并且可能在给个版本之前来回切换的人来说,一直渴望一个好的sdk管理工具举个具体的例子:有两个项目,一个项目使用jdk-8另一个项目使...","permalink":"/post/use-asdf-manage-sdk","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"效率工具","slug":"效率工具","count":1,"path":"api/categories/效率工具.json"}],"tags":[{"name":"asdf","slug":"asdf","count":1,"path":"api/tags/asdf.json"},{"name":"asdf manage","slug":"asdf-manage","count":1,"path":"api/tags/asdf-manage.json"}],"author":{"name":"finger","slug":"blog-author","avatar":"/assets/images/logo.jpg","link":"/","description":"do something funny","socials":{"github":"https://github.com/fingergohappy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}